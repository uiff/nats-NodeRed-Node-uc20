<script type="text/javascript">
  RED.nodes.registerType('datahub-input', {
    category: 'DataHub-NATS',
    color: '#ff9f43',
    defaults: {
      name: { value: '' },
      connection: { type: 'uos-config', required: true },
      providerId: { value: 'sampleprovider', required: true },
      variablesText: { value: '' }
    },
    inputs: 0,
    outputs: 1,
    icon: "white/datahub-input.svg",
    oneditprepare: function() {},
    label: function () {
      return this.name || `Input ${this.providerId || ''}`;
    },
    labelStyle: function () {
      return this.name ? 'node_label_italic' : '';
    }
  });
</script>

<script type="text/html" data-template-name="datahub-input">
  <div class="form-row">
    <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
    <input type="text" id="node-input-name">
  </div>
  <div class="form-row">
    <label for="node-input-connection"><i class="fa fa-cube"></i> u-OS Config</label>
    <input type="text" id="node-input-connection">
  </div>
  <div class="form-row">
    <label for="node-input-providerId"><i class="fa fa-id-badge"></i> Provider ID</label>
    <input type="text" id="node-input-providerId" placeholder="sampleprovider">
  </div>
  <div class="form-row">
    <label for="node-input-variablesText"><i class="fa fa-list"></i> Variables (comma separated)</label>
    <input type="text" id="node-input-variablesText" placeholder="diagnostics.status_text,diagnostics.error_count">
  </div>
</script>

<script type="text/html" data-help-name="datahub-input">
  <p><strong>DataHub Input</strong> subscribes to a provider via the u-OS Data Hub and emits JSON messages.</p>
  <dl>
    <dt>u-OS Config</dt>
    <dd>Pick the connection node that holds host, port and OAuth credentials.</dd>
    <dt>Provider ID</dt>
    <dd>Provider to read (for example <code>sampleprovider</code> or <code>u_os_adm</code>).</dd>
    <dt>Variables</dt>
    <dd>Leave empty to stream all variables or enter comma separated keys such as <code>diagnostics.status_text,diagnostics.error_count</code>.</dd>
  </dl>
  <p>Each message has <code>msg.payload</code> shaped like:</p>
<pre>{
  "type": "snapshot" | "change",
  "variables": [
    { "name": "diagnostics.status_text", "value": "ready" }
  ]
}</pre>
</script>
